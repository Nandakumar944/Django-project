<!DOCTYPE html>
<html lang="en" 
      data-theme="{% if user.is_authenticated %}{{ user.profile.theme_preference|default:'light' }}{% else %}{{ request.COOKIES.theme|default:'light' }}{% endif %}">
<head>
    <meta charset="UTF-8">
    <title>Django Blog</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <style>
        /* Light theme (default) */
        body {
            background-color: #ffffff;
            color: #000000;
        }

        /* Dark theme */
        [data-theme="dark"] body {
            background-color: #121212;
            color: #ffffff;
        }

        /* Navbar override for dark mode */
        [data-theme="dark"] .navbar {
            background-color: #1f1f1f !important;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container-fluid">
    <a class="navbar-brand" href="{% url 'home' %}">My Blog</a>
    <div class="d-flex">
      {% if user.is_authenticated %}
        <a class="btn btn-outline-light btn-sm me-2" href="{% url 'create_post' %}">New Post</a>
        <a class="btn btn-outline-light btn-sm me-2" href="{% url 'profile' user.username %}">Profile</a>
        <a class="btn btn-outline-light btn-sm me-2" href="{% url 'toggle_theme' %}">
          {% if user.profile.theme_preference|default:'light' == "light" %}
            🌙 Dark
          {% else %}
            ☀️ Light
          {% endif %}
        </a>
        <a class="btn btn-outline-light btn-sm" href="{% url 'logout' %}">Logout</a>
      {% else %}
        <a class="btn btn-outline-light btn-sm me-2" href="{% url 'login' %}">Login</a>
        <a class="btn btn-outline-light btn-sm me-2" href="{% url 'register' %}">Register</a>
        <!-- Guest theme toggle (localStorage only) -->
        <button class="btn btn-outline-light btn-sm" id="guestThemeToggle">🌙</button>
      {% endif %}
    </div>
  </div>
</nav>

<div class="container mt-4">
    {% block content %}{% endblock %}
</div>

<script>
  // For guests (not logged in) → use localStorage
  const guestToggle = document.getElementById("guestThemeToggle");
  if (guestToggle) {
    // Load stored theme
    const storedTheme = localStorage.getItem("theme") || "light";
    document.documentElement.setAttribute("data-theme", storedTheme);
    guestToggle.innerText = storedTheme === "light" ? "🌙" : "☀️";

    // Toggle on click
    guestToggle.addEventListener("click", () => {
      const current = document.documentElement.getAttribute("data-theme");
      const next = current === "light" ? "dark" : "light";
      document.documentElement.setAttribute("data-theme", next);
      localStorage.setItem("theme", next);
      guestToggle.innerText = next === "light" ? "🌙" : "☀️";
    });
  }
</script>
</body>
</html>